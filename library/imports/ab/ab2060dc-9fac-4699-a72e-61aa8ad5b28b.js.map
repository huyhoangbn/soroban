{"version":3,"sources":["assets\\scripts\\Bead.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ResourcePack } from \"./ResourcePack\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bead extends cc.Component {\r\n    @property(cc.Node)\r\n    bodyNode: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    startNode: cc.Node = null;\r\n\r\n    @property(cc.Node)\r\n    endNode: cc.Node = null;\r\n\r\n    @property(cc.Boolean)\r\n    showDebug = false;\r\n\r\n    activeSF: cc.SpriteFrame = null;\r\n    focusedSF: cc.SpriteFrame = null;\r\n    inactiveSF: cc.SpriteFrame = null;\r\n\r\n    reverted: boolean = false;\r\n\r\n    placement: number = 0;\r\n\r\n    touched: boolean = false;\r\n\r\n    nearBeads: cc.Node[] = [];\r\n\r\n    dragged: boolean = false;\r\n\r\n    initialized: boolean = false;\r\n\r\n    initialize() {\r\n        this.reverted = (this.startNode.getPosition().y > this.endNode.getPosition().y);\r\n\r\n        this.bodyNode.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n        this.bodyNode.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.bodyNode.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.bodyNode.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n\r\n        this.initialized = true;\r\n    }\r\n\r\n    update(dt) {\r\n        if(!this.initialized) return;\r\n        \r\n        // snap body to the predefined positions\r\n        if(this.touched) {\r\n            if(!this.reverted) {\r\n                if(this.bodyNode.y >= this.endNode.y) this.setPlacement(1);\r\n                else if(this.bodyNode.y <= this.startNode.y) this.setPlacement(0);\r\n            } else {\r\n                if(this.bodyNode.y <= this.endNode.y) this.setPlacement(1);\r\n                else if(this.bodyNode.y >= this.startNode.y) this.setPlacement(0);\r\n            }\r\n        }\r\n\r\n        if(this.showDebug) {\r\n            console.log(\"Placement: \" + this.placement);\r\n        }\r\n    }\r\n\r\n    applyTheme(resourcePack: ResourcePack) {\r\n        this.activeSF = resourcePack.bead_active;\r\n        this.focusedSF = resourcePack.bead_focused;\r\n        this.inactiveSF = resourcePack.bead_inactive;\r\n\r\n        this.bodyNode.getComponent(cc.Sprite).spriteFrame = this.inactiveSF;\r\n    }\r\n\r\n    reset() {\r\n        this.onTouchEnd(null);\r\n        this.setPlacement(0);\r\n    }\r\n\r\n    setPlacement(value: number) {\r\n        if(value == 0) {\r\n            // disable bead movement if placement changes only if the bead is dragged by other\r\n            if(this.placement == 1 && this.dragged) this.onTouchEnd(null);\r\n\r\n            this.bodyNode.setPosition(this.startNode.getPosition());\r\n            this.placement = 0;\r\n        } else {\r\n            if(this.placement == 0 && this.dragged) this.onTouchEnd(null);\r\n\r\n            this.bodyNode.setPosition(this.endNode.getPosition());\r\n            this.placement = 1;\r\n        }\r\n    }\r\n\r\n    setInteractive(value: boolean) {\r\n        // sloppy shit\r\n        console.log(\"interactive off\");\r\n        this.bodyNode.off(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n        this.bodyNode.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.bodyNode.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.bodyNode.off(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n\r\n        if(value) {\r\n            console.log(\"interactive on\");\r\n            this.bodyNode.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n            this.bodyNode.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n            this.bodyNode.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n            this.bodyNode.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n        }\r\n    }\r\n\r\n    onTouchStart(event: cc.Event.EventTouch) {\r\n        this.touched = true;\r\n        this.dragged = false;\r\n        this.nearBeads = [];\r\n\r\n        // don't drag any beads if user choose (5) bead\r\n        if(this.reverted) {\r\n            this.bodyNode.getComponent(cc.Sprite).spriteFrame = this.activeSF;\r\n\r\n            return;\r\n        }\r\n\r\n        if(!event) {\r\n            this.dragged = true; // dragged beads don't drag any beads with them\r\n\r\n            this.bodyNode.getComponent(cc.Sprite).spriteFrame = this.focusedSF;\r\n        } else  {\r\n            let foundThis = false;\r\n            for(let i = 1; i < 5; ++i) { // don't count last beard (top one)\r\n                let value = this.node.getParent().children[i];\r\n\r\n                if(this.node == value) {\r\n                    foundThis = true;\r\n                    continue;\r\n                }\r\n                \r\n                // add only upper beads for first placement and down beads if second placement\r\n                if((this.placement == 0 && !foundThis) || (this.placement == 1 && foundThis)) {\r\n                    // add only beads with the same placement\r\n                    if(value.name == \"Bead\" && value.getComponent(\"Bead\").placement == this.placement) {\r\n                        value.getComponent(\"Bead\").onTouchStart(null);\r\n                        this.nearBeads.push(value);\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.bodyNode.getComponent(cc.Sprite).spriteFrame = this.activeSF;\r\n        }\r\n    }\r\n\r\n    onTouchMove(event: cc.Event.EventTouch) {\r\n        if(!this.touched) return;\r\n\r\n        let delta_y = event.getDeltaY();\r\n\r\n        if(this.dragged || \r\n          (delta_y > 0 && event.getLocationY() >= this.bodyNode.getBoundingBoxToWorld().center.y) ||\r\n          (delta_y < 0 && event.getLocationY() <= this.bodyNode.getBoundingBoxToWorld().center.y)) {\r\n            this.bodyNode.y += delta_y;\r\n\r\n            // prevent beads dragged from first position to go down and from second position to go up\r\n            if((this.placement == 0 && delta_y > 0) || (this.placement == 1 && delta_y < 0))\r\n                this.nearBeads.forEach((value: cc.Node) => {\r\n                    value.getComponent(\"Bead\").onTouchMove(event);\r\n                });\r\n        }\r\n    }\r\n\r\n    onTouchEnd(event: cc.Event.EventTouch) {\r\n        this.bodyNode.setPosition((this.placement == 0 ? this.startNode.getPosition() : this.endNode.getPosition()));\r\n\r\n        this.nearBeads.forEach((value: cc.Node) => {\r\n            value.getComponent(\"Bead\").onTouchEnd(event);\r\n        });\r\n\r\n        this.bodyNode.getComponent(cc.Sprite).spriteFrame = this.inactiveSF;\r\n\r\n        this.touched = false;\r\n        this.dragged = false;\r\n        this.nearBeads = [];\r\n    }\r\n}\r\n"]}