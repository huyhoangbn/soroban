{"version":3,"sources":["assets\\scripts\\tutorial\\TutorialManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Global } from \"../Global\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TutorialManager extends cc.Component {\r\n    @property (cc.Node)\r\n    loadingScreen: cc.Node = null;\r\n\r\n    @property (cc.Node)\r\n    abacus: cc.Node = null;\r\n\r\n    @property (cc.Node)\r\n    mainTutorial: cc.Node = null;\r\n\r\n    @property (cc.Node)\r\n    arrowNode: cc.Node = null;\r\n\r\n    @property (cc.Node)\r\n    backSplash: cc.Node = null;\r\n\r\n    tutorialParts: cc.Node[] = null;\r\n    currentPartIndex: number = null;\r\n\r\n    completeValue: number = null;\r\n\r\n    onLoad() {\r\n        this.loadingScreen.active = true;\r\n\r\n        cc.resources.load(\"prefabs/tutorial/\" + Global.currentTutorial, cc.Prefab, (error: Error, asset: cc.Prefab) => {\r\n            if(error) {\r\n                console.error(error);\r\n            } else {\r\n                let node = cc.instantiate(asset);\r\n\r\n                while(node.children.length > 0) {\r\n                    let value = node.children[0];\r\n\r\n                    value.removeFromParent();\r\n                    this.mainTutorial.addChild(value);\r\n\r\n                    console.log(\"Added!\");\r\n                }\r\n\r\n                node.destroy();\r\n\r\n                this.abacus.getComponent(\"Abacus\").initialize().then(() => {\r\n                    this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n\r\n                    if(Global.firstTime) this.node.parent.getChildByName(\"Back\").active = false;\r\n        \r\n                    this.startTutorial();\r\n                    this.loadingScreen.active = false;\r\n                }).catch(error => console.error(error));\r\n            }          \r\n        });\r\n\r\n        \r\n    }\r\n\r\n    update (dt) {\r\n        if(this.completeValue != null) {\r\n            if(this.abacus.getComponent(\"Abacus\").score == this.completeValue) {\r\n                this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n                this.completeValue = null;\r\n\r\n                this.onTouchStart(null);\r\n            }\r\n        }\r\n    }\r\n\r\n    loadMenu() {\r\n        if(Global.firstTime) Global.firstTime = false;\r\n\r\n        cc.director.loadScene(\"scenes/menu\");\r\n    }\r\n\r\n    startTutorial() {\r\n        this.tutorialParts = this.mainTutorial.children;\r\n\r\n        this.changeTutorialPart(0);\r\n    }\r\n\r\n    changeTutorialPart(value: number) {\r\n        if(value < 0) {\r\n            console.error(\"Invalid index of tutorial part!\");\r\n            return;\r\n        } else if(value == this.tutorialParts.length) {\r\n            this.backSplash.active = true;\r\n            this.arrowNode.active = false;\r\n            this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n\r\n            return;\r\n        }\r\n\r\n        if(this.currentPartIndex != null) {\r\n            this.tutorialParts[this.currentPartIndex].active = false;\r\n        }\r\n\r\n        this.currentPartIndex = value;\r\n\r\n        let node = this.tutorialParts[this.currentPartIndex];\r\n        let script = node.getComponent(\"TutorialNode\");\r\n        node.active = true;\r\n\r\n        // reset abacus to normal state (everything on 0 and not interactive)\r\n        this.abacus.getComponent(\"Abacus\").reset();\r\n        this.abacus.getComponent(\"Abacus\").setInteractive(false);\r\n\r\n        if(script.predefinedRows.length > 0) {\r\n            for(let i = 0; i < script.predefinedRows.length; ++i) {\r\n                this.abacus.getComponent(\"Abacus\").setRowValue(i, script.predefinedRows[i]);\r\n            }\r\n        }\r\n\r\n        if(script.interactiveRows.length > 0 && script.completeValue >= 0) {\r\n            this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n\r\n            for(let i = 0; i < script.interactiveRows.length; ++i) {\r\n                this.abacus.getComponent(\"Abacus\").setRowInteractive(i, script.interactiveRows[i]);\r\n            }\r\n\r\n            this.completeValue = script.completeValue;\r\n            console.log(\"Complete value: \" + this.completeValue);\r\n\r\n            this.arrowNode.active = false;\r\n        } else {\r\n            this.arrowNode.active = true;\r\n        }\r\n\r\n        console.log(\"Node name: \" + node.name);\r\n    }\r\n\r\n    onTouchStart(event: any) {\r\n        this.changeTutorialPart(this.currentPartIndex + 1);\r\n    }\r\n}\r\n"]}