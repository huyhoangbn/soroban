
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/miniGame/raphael/component/R.transform.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'db19cFf2j1BhqqpBuWkH2Kk', 'R.transform');
// scripts/miniGame/raphael/component/R.transform.js

"use strict";

var Transform = {
  properties: {
    _scale: {
      "default": cc.v2(1, 1),
      type: cc.Vec2
    },
    _position: {
      "default": cc.v2(0, 0),
      type: cc.Vec2
    },
    _rotation: 0,
    _flipX: false,
    _flipY: false,
    _transform: {
      "default": function _default() {
        return {
          a: 1,
          b: 0,
          c: 0,
          d: 1,
          tx: 0,
          ty: 0
        };
      },
      serializable: false
    },
    _worldTransform: {
      "default": function _default() {
        return {
          a: 1,
          b: 0,
          c: 0,
          d: 1,
          tx: 0,
          ty: 0
        };
      },
      serializable: false
    },
    _transformDirty: {
      "default": true,
      serializable: false,
      notify: function notify() {
        if (this._transformDirty) {
          if (this.parent) {
            this.parent._transformDirty = true;
          }

          this._dirty = true;
        }
      }
    },
    scale: {
      get: function get() {
        return this._scale;
      },
      set: function set(value) {
        if (this._scale.equals(value)) {
          return;
        }

        this._scale = value;
        this._transformDirty = true;
      }
    },
    position: {
      get: function get() {
        return this._position;
      },
      set: function set(value) {
        if (this._position.equals(value)) {
          return;
        }

        this._position = value;
        this._transformDirty = true;
      }
    },
    rotation: {
      get: function get() {
        return this._rotation;
      },
      set: function set(value) {
        if (this._rotation === value) {
          return;
        }

        this._rotation = value;
        this._transformDirty = true;
      }
    },
    flipX: {
      get: function get() {
        return this._flipX;
      },
      set: function set(value) {
        if (this._flipX === value) {
          return;
        }

        this._flipX = value;
        this._transformDirty = true;
      }
    },
    flipY: {
      get: function get() {
        return this._flipY;
      },
      set: function set(value) {
        if (this._flipY === value) {
          return;
        }

        this._flipY = value;
        this._transformDirty = true;
      }
    }
  },
  _transformCommand: function _transformCommand(cmd, t) {
    if (cmd.length <= 1) {
      return cmd;
    }

    cmd = cmd.slice(1, cmd.length);

    if (t.a === 1 && t.d === 1 && t.b === 0 && t.c === 0 && t.tx === 0 && t.ty === 0) {
      return cmd;
    }

    var tempPoint = cc.v2();

    for (var i = 0, ii = cmd.length / 2; i < ii; i++) {
      var j = i * 2;
      tempPoint.x = cmd[j];
      tempPoint.y = cmd[j + 1];
      tempPoint = cc.AffineTransform.transformVec2(cc.v2(0, 0), tempPoint, t);
      cmd[j] = tempPoint.x;
      cmd[j + 1] = tempPoint.y;
    }

    return cmd;
  },
  getTransform: function getTransform() {
    if (this._transformDirty) {
      var scaleX = this.flipX ? -this._scale.x : this._scale.x;
      var scaleY = this.flipY ? -this._scale.y : this._scale.y;
      var positionX = this._position.x;
      var positionY = this._position.y;
      var rotation = this._rotation;
      var t = this._transform;
      t.tx = positionX;
      t.ty = positionY;
      t.a = t.d = 1;
      t.b = t.c = 0; // rotation Cos and Sin

      if (rotation) {
        var rotationRadians = rotation * 0.017453292519943295; //0.017453292519943295 = (Math.PI / 180);   for performance

        t.c = Math.sin(rotationRadians);
        t.d = Math.cos(rotationRadians);
        t.a = t.d;
        t.b = -t.c;
      } // Firefox on Vista and XP crashes
      // GPU thread in case of scale(0.0, 0.0)


      var sx = scaleX < 0.000001 && scaleX > -0.000001 ? 0.000001 : scaleX,
          sy = scaleY < 0.000001 && scaleY > -0.000001 ? 0.000001 : scaleY; // scale

      if (scaleX !== 1 || scaleY !== 1) {
        t.a *= sx;
        t.b *= sx;
        t.c *= sy;
        t.d *= sy;
      }

      this._transformDirty = false;
    }

    return this._transform;
  },
  getWorldTransform: function getWorldTransform() {
    if (this.parent) {
      return cc.AffineTransform.concat(cc.AffineTransform.identity, this.parent.getWorldTransform(), this.getTransform());
    }

    return this.getTransform();
  },
  updateTransform: function updateTransform(parentTransformDirty) {
    if (this._transformDirty || parentTransformDirty) {
      var scaleX = this.flipX ? -this._scale.x : this._scale.x;
      var scaleY = this.flipY ? -this._scale.y : this._scale.y;
      var positionX = this._position.x;
      var positionY = this._position.y;
      var rotation = this._rotation;
      var t = this._transform;
      t.tx = positionX;
      t.ty = positionY;
      t.a = t.d = 1;
      t.b = t.c = 0; // rotation Cos and Sin

      if (rotation) {
        var rotationRadians = rotation * 0.017453292519943295; //0.017453292519943295 = (Math.PI / 180);   for performance

        t.c = Math.sin(rotationRadians);
        t.d = Math.cos(rotationRadians);
        t.a = t.d;
        t.b = -t.c;
      } // Firefox on Vista and XP crashes
      // GPU thread in case of scale(0.0, 0.0)


      var sx = scaleX < 0.000001 && scaleX > -0.000001 ? 0.000001 : scaleX,
          sy = scaleY < 0.000001 && scaleY > -0.000001 ? 0.000001 : scaleY; // scale

      if (scaleX !== 1 || scaleY !== 1) {
        t.a *= sx;
        t.b *= sx;
        t.c *= sy;
        t.d *= sy;
      }
    }

    if (this.parent) {
      this._worldTransform = cc.AffineTransform.concat(cc.AffineTransform.identity, this.parent._worldTransform, this._transform);
    } else {
      this._worldTransform = this._transform;
    }

    var children = this.children;

    if (children) {
      for (var i = 0, ii = children.length; i < ii; i++) {
        var child = children[i];
        child.updateTransform(parentTransformDirty || this._transformDirty);
      }
    }

    this._transformDirty = false;
  }
};
module.exports = Transform;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcbWluaUdhbWVcXHJhcGhhZWxcXGNvbXBvbmVudFxcUi50cmFuc2Zvcm0uanMiXSwibmFtZXMiOlsiVHJhbnNmb3JtIiwicHJvcGVydGllcyIsIl9zY2FsZSIsImNjIiwidjIiLCJ0eXBlIiwiVmVjMiIsIl9wb3NpdGlvbiIsIl9yb3RhdGlvbiIsIl9mbGlwWCIsIl9mbGlwWSIsIl90cmFuc2Zvcm0iLCJhIiwiYiIsImMiLCJkIiwidHgiLCJ0eSIsInNlcmlhbGl6YWJsZSIsIl93b3JsZFRyYW5zZm9ybSIsIl90cmFuc2Zvcm1EaXJ0eSIsIm5vdGlmeSIsInBhcmVudCIsIl9kaXJ0eSIsInNjYWxlIiwiZ2V0Iiwic2V0IiwidmFsdWUiLCJlcXVhbHMiLCJwb3NpdGlvbiIsInJvdGF0aW9uIiwiZmxpcFgiLCJmbGlwWSIsIl90cmFuc2Zvcm1Db21tYW5kIiwiY21kIiwidCIsImxlbmd0aCIsInNsaWNlIiwidGVtcFBvaW50IiwiaSIsImlpIiwiaiIsIngiLCJ5IiwiQWZmaW5lVHJhbnNmb3JtIiwidHJhbnNmb3JtVmVjMiIsImdldFRyYW5zZm9ybSIsInNjYWxlWCIsInNjYWxlWSIsInBvc2l0aW9uWCIsInBvc2l0aW9uWSIsInJvdGF0aW9uUmFkaWFucyIsIk1hdGgiLCJzaW4iLCJjb3MiLCJzeCIsInN5IiwiZ2V0V29ybGRUcmFuc2Zvcm0iLCJjb25jYXQiLCJpZGVudGl0eSIsInVwZGF0ZVRyYW5zZm9ybSIsInBhcmVudFRyYW5zZm9ybURpcnR5IiwiY2hpbGRyZW4iLCJjaGlsZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsSUFBSUEsU0FBUyxHQUFHO0FBRVpDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxNQUFNLEVBQUU7QUFDSixpQkFBU0MsRUFBRSxDQUFDQyxFQUFILENBQU0sQ0FBTixFQUFTLENBQVQsQ0FETDtBQUVKQyxNQUFBQSxJQUFJLEVBQUVGLEVB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cm9wZXJ0aWVzOiB7XG4gICAgICAgIF9zY2FsZToge1xuICAgICAgICAgICAgZGVmYXVsdDogY2MudjIoMSwgMSksXG4gICAgICAgICAgICB0eXBlOiBjYy5WZWMyXG4gICAgICAgIH0sXG4gICAgICAgIF9wb3NpdGlvbjoge1xuICAgICAgICAgICAgZGVmYXVsdDogY2MudjIoMCwwKSxcbiAgICAgICAgICAgIHR5cGU6IGNjLlZlYzJcbiAgICAgICAgfSxcbiAgICAgICAgX3JvdGF0aW9uOiAwLFxuICAgICAgICBcbiAgICAgICAgX2ZsaXBYOiBmYWxzZSxcbiAgICAgICAgX2ZsaXBZOiBmYWxzZSxcblxuICAgICAgICBfdHJhbnNmb3JtOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHthOiAxLCBiOiAwLCBjOiAwLCBkOiAxLCB0eDogMCwgdHk6IDB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlcmlhbGl6YWJsZTogZmFsc2VcbiAgICAgICAgfSxcblxuICAgICAgICBfd29ybGRUcmFuc2Zvcm06IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge2E6IDEsIGI6IDAsIGM6IDAsIGQ6IDEsIHR4OiAwLCB0eTogMH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VyaWFsaXphYmxlOiBmYWxzZVxuICAgICAgICB9LFxuXG4gICAgICAgIF90cmFuc2Zvcm1EaXJ0eToge1xuICAgICAgICAgICAgZGVmYXVsdDogdHJ1ZSxcbiAgICAgICAgICAgIHNlcmlhbGl6YWJsZTogZmFsc2UsXG5cbiAgICAgICAgICAgIG5vdGlmeTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl90cmFuc2Zvcm1EaXJ0eSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Ll90cmFuc2Zvcm1EaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNjYWxlOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NhbGU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2NhbGUuZXF1YWxzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3NjYWxlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNmb3JtRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcG9zaXRpb24uZXF1YWxzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNmb3JtRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJvdGF0aW9uOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcm90YXRpb247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcm90YXRpb24gPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fcm90YXRpb24gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1EaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cblxuICAgICAgICBmbGlwWDoge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZsaXBYO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZsaXBYID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2ZsaXBYID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNmb3JtRGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGZsaXBZOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZmxpcFk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZmxpcFkgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fZmxpcFkgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1EaXJ0eSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgfSxcblxuICAgIF90cmFuc2Zvcm1Db21tYW5kOiBmdW5jdGlvbiAoY21kLCB0KSB7XG4gICAgICAgIGlmIChjbWQubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICAgIHJldHVybiBjbWQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNtZCA9IGNtZC5zbGljZSgxLCBjbWQubGVuZ3RoKTtcblxuICAgICAgICBpZiAodC5hID09PSAxICYmIHQuZCA9PT0gMSAmJlxuICAgICAgICAgICAgdC5iID09PSAwICYmIHQuYyA9PT0gMCAmJlxuICAgICAgICAgICAgdC50eCA9PT0gMCAmJiB0LnR5ID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gY21kO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHRlbXBQb2ludCA9IGNjLnYyKCk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY21kLmxlbmd0aCAvIDI7IGkgPCBpaTsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaiA9IGkqMjtcbiAgICAgICAgICAgIHRlbXBQb2ludC54ID0gY21kW2pdO1xuICAgICAgICAgICAgdGVtcFBvaW50LnkgPSBjbWRbaiArIDFdO1xuXG4gICAgICAgICAgICB0ZW1wUG9pbnQgPSBjYy5BZmZpbmVUcmFuc2Zvcm0udHJhbnNmb3JtVmVjMihjYy52MigwLCAwKSwgdGVtcFBvaW50LCB0KTtcblxuICAgICAgICAgICAgY21kW2pdID0gdGVtcFBvaW50Lng7XG4gICAgICAgICAgICBjbWRbaisxXSA9IHRlbXBQb2ludC55O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNtZDtcbiAgICB9LFxuXG4gICAgZ2V0VHJhbnNmb3JtOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl90cmFuc2Zvcm1EaXJ0eSkge1xuICAgICAgICAgICAgdmFyIHNjYWxlWCA9IHRoaXMuZmxpcFggPyAtdGhpcy5fc2NhbGUueCA6IHRoaXMuX3NjYWxlLng7XG4gICAgICAgICAgICB2YXIgc2NhbGVZID0gdGhpcy5mbGlwWSA/IC10aGlzLl9zY2FsZS55IDogdGhpcy5fc2NhbGUueTtcbiAgICAgICAgICAgIHZhciBwb3NpdGlvblggPSB0aGlzLl9wb3NpdGlvbi54O1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uWSA9IHRoaXMuX3Bvc2l0aW9uLnk7XG4gICAgICAgICAgICB2YXIgcm90YXRpb24gPSB0aGlzLl9yb3RhdGlvbjtcblxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLl90cmFuc2Zvcm07XG4gICAgICAgICAgICB0LnR4ID0gcG9zaXRpb25YO1xuICAgICAgICAgICAgdC50eSA9IHBvc2l0aW9uWTtcbiAgICAgICAgICAgIHQuYSA9IHQuZCA9IDE7XG4gICAgICAgICAgICB0LmIgPSB0LmMgPSAwO1xuXG4gICAgICAgICAgICAvLyByb3RhdGlvbiBDb3MgYW5kIFNpblxuICAgICAgICAgICAgaWYgKHJvdGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uUmFkaWFucyA9IHJvdGF0aW9uICogMC4wMTc0NTMyOTI1MTk5NDMyOTU7ICAvLzAuMDE3NDUzMjkyNTE5OTQzMjk1ID0gKE1hdGguUEkgLyAxODApOyAgIGZvciBwZXJmb3JtYW5jZVxuICAgICAgICAgICAgICAgIHQuYyA9IE1hdGguc2luKHJvdGF0aW9uUmFkaWFucyk7XG4gICAgICAgICAgICAgICAgdC5kID0gTWF0aC5jb3Mocm90YXRpb25SYWRpYW5zKTtcbiAgICAgICAgICAgICAgICB0LmEgPSB0LmQ7XG4gICAgICAgICAgICAgICAgdC5iID0gLXQuYztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlyZWZveCBvbiBWaXN0YSBhbmQgWFAgY3Jhc2hlc1xuICAgICAgICAgICAgLy8gR1BVIHRocmVhZCBpbiBjYXNlIG9mIHNjYWxlKDAuMCwgMC4wKVxuICAgICAgICAgICAgdmFyIHN4ID0gKHNjYWxlWCA8IDAuMDAwMDAxICYmIHNjYWxlWCA+IC0wLjAwMDAwMSkgPyAwLjAwMDAwMSA6IHNjYWxlWCxcbiAgICAgICAgICAgICAgICBzeSA9IChzY2FsZVkgPCAwLjAwMDAwMSAmJiBzY2FsZVkgPiAtMC4wMDAwMDEpID8gMC4wMDAwMDEgOiBzY2FsZVk7XG5cbiAgICAgICAgICAgIC8vIHNjYWxlXG4gICAgICAgICAgICBpZiAoc2NhbGVYICE9PSAxIHx8IHNjYWxlWSAhPT0gMSkge1xuICAgICAgICAgICAgICAgIHQuYSAqPSBzeDtcbiAgICAgICAgICAgICAgICB0LmIgKj0gc3g7XG4gICAgICAgICAgICAgICAgdC5jICo9IHN5O1xuICAgICAgICAgICAgICAgIHQuZCAqPSBzeTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fdHJhbnNmb3JtRGlydHkgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl90cmFuc2Zvcm07XG4gICAgfSxcblxuICAgIGdldFdvcmxkVHJhbnNmb3JtOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGNjLkFmZmluZVRyYW5zZm9ybS5jb25jYXQoY2MuQWZmaW5lVHJhbnNmb3JtLmlkZW50aXR5LCB0aGlzLnBhcmVudC5nZXRXb3JsZFRyYW5zZm9ybSgpLCB0aGlzLmdldFRyYW5zZm9ybSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmdldFRyYW5zZm9ybSgpO1xuICAgIH0sXG5cbiAgICB1cGRhdGVUcmFuc2Zvcm06IGZ1bmN0aW9uIChwYXJlbnRUcmFuc2Zvcm1EaXJ0eSkge1xuICAgICAgICBpZiAodGhpcy5fdHJhbnNmb3JtRGlydHkgfHwgcGFyZW50VHJhbnNmb3JtRGlydHkpIHtcbiAgICAgICAgICAgIHZhciBzY2FsZVggPSB0aGlzLmZsaXBYID8gLXRoaXMuX3NjYWxlLnggOiB0aGlzLl9zY2FsZS54O1xuICAgICAgICAgICAgdmFyIHNjYWxlWSA9IHRoaXMuZmxpcFkgPyAtdGhpcy5fc2NhbGUueSA6IHRoaXMuX3NjYWxlLnk7XG4gICAgICAgICAgICB2YXIgcG9zaXRpb25YID0gdGhpcy5fcG9zaXRpb24ueDtcbiAgICAgICAgICAgIHZhciBwb3NpdGlvblkgPSB0aGlzLl9wb3NpdGlvbi55O1xuICAgICAgICAgICAgdmFyIHJvdGF0aW9uID0gdGhpcy5fcm90YXRpb247XG5cbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5fdHJhbnNmb3JtO1xuICAgICAgICAgICAgdC50eCA9IHBvc2l0aW9uWDtcbiAgICAgICAgICAgIHQudHkgPSBwb3NpdGlvblk7XG4gICAgICAgICAgICB0LmEgPSB0LmQgPSAxO1xuICAgICAgICAgICAgdC5iID0gdC5jID0gMDtcblxuICAgICAgICAgICAgLy8gcm90YXRpb24gQ29zIGFuZCBTaW5cbiAgICAgICAgICAgIGlmIChyb3RhdGlvbikge1xuICAgICAgICAgICAgICAgIHZhciByb3RhdGlvblJhZGlhbnMgPSByb3RhdGlvbiAqIDAuMDE3NDUzMjkyNTE5OTQzMjk1OyAgLy8wLjAxNzQ1MzI5MjUxOTk0MzI5NSA9IChNYXRoLlBJIC8gMTgwKTsgICBmb3IgcGVyZm9ybWFuY2VcbiAgICAgICAgICAgICAgICB0LmMgPSBNYXRoLnNpbihyb3RhdGlvblJhZGlhbnMpO1xuICAgICAgICAgICAgICAgIHQuZCA9IE1hdGguY29zKHJvdGF0aW9uUmFkaWFucyk7XG4gICAgICAgICAgICAgICAgdC5hID0gdC5kO1xuICAgICAgICAgICAgICAgIHQuYiA9IC10LmM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZpcmVmb3ggb24gVmlzdGEgYW5kIFhQIGNyYXNoZXNcbiAgICAgICAgICAgIC8vIEdQVSB0aHJlYWQgaW4gY2FzZSBvZiBzY2FsZSgwLjAsIDAuMClcbiAgICAgICAgICAgIHZhciBzeCA9IChzY2FsZVggPCAwLjAwMDAwMSAmJiBzY2FsZVggPiAtMC4wMDAwMDEpID8gMC4wMDAwMDEgOiBzY2FsZVgsXG4gICAgICAgICAgICAgICAgc3kgPSAoc2NhbGVZIDwgMC4wMDAwMDEgJiYgc2NhbGVZID4gLTAuMDAwMDAxKSA/IDAuMDAwMDAxIDogc2NhbGVZO1xuXG4gICAgICAgICAgICAvLyBzY2FsZVxuICAgICAgICAgICAgaWYgKHNjYWxlWCAhPT0gMSB8fCBzY2FsZVkgIT09IDEpIHtcbiAgICAgICAgICAgICAgICB0LmEgKj0gc3g7XG4gICAgICAgICAgICAgICAgdC5iICo9IHN4O1xuICAgICAgICAgICAgICAgIHQuYyAqPSBzeTtcbiAgICAgICAgICAgICAgICB0LmQgKj0gc3k7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3dvcmxkVHJhbnNmb3JtID0gY2MuQWZmaW5lVHJhbnNmb3JtLmNvbmNhdChjYy5BZmZpbmVUcmFuc2Zvcm0uaWRlbnRpdHksIHRoaXMucGFyZW50Ll93b3JsZFRyYW5zZm9ybSwgdGhpcy5fdHJhbnNmb3JtKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3dvcmxkVHJhbnNmb3JtID0gdGhpcy5fdHJhbnNmb3JtO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcbiAgICAgICAgaWYgKGNoaWxkcmVuKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07XG4gICAgICAgICAgICAgICAgY2hpbGQudXBkYXRlVHJhbnNmb3JtKHBhcmVudFRyYW5zZm9ybURpcnR5IHx8IHRoaXMuX3RyYW5zZm9ybURpcnR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSAgICAgICAgXG5cbiAgICAgICAgdGhpcy5fdHJhbnNmb3JtRGlydHkgPSBmYWxzZTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRyYW5zZm9ybTtcbiJdfQ==